% !TEX TS-program = xelatex
% !TEX encoding = UTF-8 Unicode
% this template is specifically designed to be typeset with XeLaTeX;
% it will not work with other engines, such as pdfLaTeX

%%% Count out columns for fixed-width source font
% 000000011111111112222222222333333333344444444445555555555666666666677777777778
% 345678901234567890123456789012345678901234567890123456789012345678901234567890

%% use [draft] for a draft version with boxes instead of images
%% Paper size: a4paper (modern size) or legalpaper (close to original)
%% Original size = 217.6 x 338.3 mm
%% Legal size    = 215.9 x 355.6 mm
\documentclass[12pt,twoside,a4paper]{book}

%%% Geometry package to make the margins better match the original
%% use [showframe] to show the frames
%\usepackage[top=18mm, bottom=55mm, inner=24mm, outer=38mm]{geometry}

%%% Allow generation of pseudo-latin body text for testing
%% Optional parameter [x-y] where x and y are numbers: generate paragraph
%% number x through y (150 paragraphs available).
%\usepackage{lipsum}

%%% Array package so we can use m{'width'} and adjust the row spacing in tables
\usepackage{array}

%%% Control the layout of chapter headers
\usepackage{titlesec}

%%% Disable chapter/section numbering.
%\setcounter{secnumdepth}{0}
%%  Put Chapters/Sections/Subsections in the Table of Contents
\setcounter{tocdepth}{3}

%%% Allow the text to flow around tables and figures.
%% (Must load before bidi package, i.e. before polyglossia package)
%\usepackage{wrapfig}

\usepackage{fontspec} % Openfont specifications for XeTeX;
% fontspec automatically loads xltxtra and xunicode, both of which are needed.
% Though using \vfrac{}{} (part of xltxtra) without explicit loading of
% xltxtra does not work.
\usepackage{xltxtra}

%%% Main body text is in latin. We want:
%% Modern typesetting
%% The long s shown as 's'
%% No ligatures
%% No swishes, not on 'Q' nor on anything else
%% Modern numbers

\setmainfont{Hoefler Text}[
]

%%% Add a font that supports Greek
\newfontfamily\greekfont{Arial Unicode MS}

%%% Add a font that supports Hebrew
\newfontfamily\hebrewfont{Arial Hebrew}

%%% Add a font that supports Arabic
\newfontfamily\arabicfont{Arial Unicode MS}

%%% Add a font that has Astrological symbols
\newfontfamily\astrofont{Menlo}
%% Command to allow "\astro{some text}"
\newcommand\astro[1]{{\astrofont #1}}

%%% Add a font for the references to line numbers in the original
\newfontfamily\nrfont{Arial Unicode MS}

%%% Dummy Command to make header of any size
%% use: head{<scalesize>}{<spacing>}{<text>}
%% <scalesize> is a sizefactor relative to normal size
%% <spacing> is the LetterSpace parameter
\newcommand\head[3]{}

%%% Commands to number paragraphs
%% http://tex.stackexchange.com/questions/10513/automatically-assign-a-number-to-every-paragraph
%% get marginpars to always show up on the correct side (need to compile twice)
\usepackage{mparhack}

%% No indent on paragraphs, because we make a paragraph out of each sentence.
%\setlength\parindent{0cm}

%% Command \parnum to format the paragraph counter number
%% (in bold, arabic numbers)
\newcommand\parnum{%
    \bfseries\footnotesize\arabic{parcount}%
}

%% Special paragraph counter which resets with every 'subject'
%% (represented as a subsection)
\newcounter{parcount}[subsection]

%% Command for an isolated paragraph counter mark
%% Useful e.g. for big, multi-paragraph spanning Initials
\newcommand\p{%
%    \stepcounter{parcount}%
%    \leavevmode\marginpar[\hfill\parnum]{\parnum}%
}

%% Define an environment to use in the source.
\newenvironment{parnumbers}{%
%    \par%
%    \everypar{%
%        \stepcounter{parcount}%
%        \leavevmode\marginpar[\hfill\parnum]{\parnum}%
%    }%
}{}

%%% Commands to refer to line numbers in the original
%% Each beginning of a sentence is marked with the line number in the original
%% where the sentence begins. Together with the page number in the original
%% (and chapter name for those parts that are outside the normal page numbers)
%% this uniquely identifies a line in the document.
%% In the interpreted transcription, this number can be printed before
%% the sentence, between parentheses. Example:
%%  "(7) Sed longe aliter animatos experti sumus ..."
%% In the litteral transcription we can leave these numbers out. Example:
%%  "Sed longe aliter animatos experti sumus ..."
%% We might, for clarity, add the page number to the first sentence on a page.
%% Example:
%%  "(II:2) Iam quemadmodum Epochae sunt notationes, ..."

%% Command \ln{number} to show the line number
\newcommand{\lnr}[1]{{\nrfont({#1}) }}

%% Command \pln{page,number} to show the page and the line number
\newcommand{\plnr}[2]{{\nrfont({#1}:{#2}) }}

%% Register the current page number (dummy for now)
\newcommand{\pnr}[1]{}

%% (dummy)
%% Our own cookup to put letters in the margin to indicate quarters of a
%% page (A-D) as used in the original.
%% Uses mparhack.
%% Because of limitations of \marginpar{} the margin letters must go
%% on the same side as the paragraph numbers. We put them a bit further
%% away from the body text to make them more distinct.
\newcommand\mletter[1]{}

%%% No drop caps (illuminated initial letters)

%%% Use polyglossia to handle multiple languages
%% We have (at least): latin, polytonic greek, hebrew, arabic, persian
%% (Contains bidi package, and must be loaded *after*:
%%  wrapfig, lettrine)
\usepackage[quiet]{polyglossia}
\setmainlanguage{latin}
\setotherlanguage{greek}
\setotherlanguage{hebrew}
\setotherlanguage{arabic}
\setotherlanguage{english}

%%% Reduce the white space above and below a chapter title
%%% The word "Chapter" (or "Caput") and the number are removed by making
%%% the third parameter empty.
%% Note: these commands must be given *after* plyglossia is loaded and
%% its commands (\setotherlanguage{}) are given
%\titleformat{\chapter}[hang]
%  {\normalfont\tiny\bfseries}{}{0em}{\Huge}
%\titlespacing*{\chapter}{0pt}{-10pt}{0.5cm}

%%% Reduce the white space above and below figures
\setlength\intextsep{0pt}

%% Prevent text from going outside the margins, by making
%% the word spacing sloppy
\sloppy

%%% Tell XeTeX where to look for graphics files
%% Note: all file paths are relative to the root document, i.e.
%% the tex file that is passed as an argument to the compiler.
%% In other words: this file.
\graphicspath{{./img/}}

%%%========================================================%%%

%% list the parts we want to compile
\includeonly{./tex/prolegomena}

\begin{document}

%% Source file for testing. Comment out when not testing
%% Does not need to be mentioned in the above \includeonly{}
%\input{../test/dropcap}

\frontmatter
\include{./tex/title}
\include{./tex/dedication}
\include{./tex/greek-quotes}
\include{./tex/prolegomena}

%% ToC generation gives obscure errors; solution: delete the .aux files
%% and re-compile (twice)
\tableofcontents{}

\mainmatter
\include{./tex/liber-primus}
\include{./tex/liber-secundus}
\include{./tex/liber-tertius}
\include{./tex/liber-quartus}
\include{./tex/liber-quintus}
\include{./tex/liber-sextus}
\include{./tex/liber-septimus}

\appendix
\include{./tex/nomenclator}
\include{./tex/index-rerum-et-verborum}
\include{./tex/index-graecarum-vocum}
\include{./tex/index-orientalium-vocum}
\include{./tex/errata}

\backmatter
\include{./tex/operis-finis}
\include{./tex/fragmenta-selecta}

\end{document}
