\documentclass{book}
\setcounter{secnumdepth}{0}
\setcounter{tocdepth}{3}

\usepackage[utf8]{inputenc}
\usepackage[LGR,T1]{fontenc}

%%% Kepler Fonts: Write with long s and other old-style typesetting
%% from http://tex.stackexchange.com/questions/9495/latex-font-for-18th-century-english
%% also http://ctan.org/pkg/kpfonts
\usepackage[veryoldstyle]{kpfonts}

%%% Handle Greek
%% load alphabeta after math setup and encoding setup!
\usepackage{alphabeta}

\usepackage[greek,latin,english]{babel}

%%% Make special UTF-8 characters known to LaTeX
%% Weird: if the code does not contain an A-F character, it is taken to be an octal code ("codes <00A0 connot
%% be redefined".
%% Odd: this problem went away again. Hex codes such as 0113 are now accepted.
%% Suggestions from the manual such as:
%% 0123 decimal, '0123 octal, "0123 hex
%% do not work (complains about missing closing quote characters)
\DeclareUnicodeCharacter{00A0}{~}     % no-break space
\DeclareUnicodeCharacter{0101}{\={a}} % LATIN SMALL LETTER A WITH MACRON (hex 0101, shorthand for 'am')
\DeclareUnicodeCharacter{0113}{\={e}} % LATIN SMALL LETTER E WITH MACRON (hex 0113, shorthand for 'em')
\DeclareUnicodeCharacter{014D}{\={o}} % LATIN SMALL LETTER O WITH MACRON (hex 014D, shorthand for 'om')
\DeclareUnicodeCharacter{016B}{\={u}} % LATIN SMALL LETTER U WITH MACRON (hex 016B, shorthand for 'um')
\DeclareUnicodeCharacter{0229}{\,{e}} % LATIN SMALL LETTER E WITH CEDILLA (hex 0229, shorthand for 'ae')

%%% narrower margins to get more text on the page
%\usepackage{fullpage}

%%% Commands to number paragraphs
%% http://tex.stackexchange.com/questions/10513/automatically-assign-a-number-to-every-paragraph
\usepackage{mparhack}   % get marginpars to always show up on the correct side (need to compile twice)
\usepackage{lipsum}     % for dummy text

\setlength\parindent{0cm}

%% Command \parnum to format the paragraph counter number (in bold, arabic numbers)
\newcommand\parnum{%
    \bfseries\arabic{parcount}%
}

%% Special paragraph counter which resets with every 'subject' (represented as a subsection)
\newcounter{parcount}[subsection]

%% Command for an isolated paragraph counter mark
%% Useful e.g. for big, multi-paragraph spanning Initials
\newcommand\p{%
    \stepcounter{parcount}%
    \leavevmode\marginpar[\hfill\parnum]{\parnum}%
}

%% Define an environment to use in the source.
\newenvironment{parnumbers}{%
    \par%
    \everypar{%
        \stepcounter{parcount}%
        \leavevmode\marginpar[\hfill\parnum]{\parnum}%
    }%
}{}

%% Our own cookup to put letters in the margin to indicate quarters of a page (A-D) as used in the original
% Uses mparhack
% Because of limitations of \marginpar{} the margin letters must go on the same side as the paragraph
% numbers. We put them a bit further away from the body text to make them more distinct.
\newcommand\mletter[1]{%
    \leavevmode\marginpar[\hfill\textbf{#1}\hspace*{24pt}]{\hspace*{24pt}\textbf{#1}}%
}

%%% Make drop caps (illuminated initial letters)
%% http://texblog.org/2011/05/21/drop-caps-with-lettrine/
%% Problem: only covers 1 paragraph. The next paragraph will be left-adjusted to the margin again
\usepackage{type1cm}
\usepackage{lettrine}
%\usepackage{graphicx}
%% Add fancy font for Initials
%% https://www.lemald.org/blog/?p=108
\input GoudyIn.fd
\newcommand*\initfamily{\usefont{U}{GoudyIn}{xl}{n}}

%% Define a command for illuminated first lines.
%% Syntax: \dropcapil{lines}{initial}{caps}
%% Parameters:
%%    'lines'=how high to make the initial letter, in lines
%%    'initial' = initial letter
%%    'caps' = letters to follow the initial to be made small caps
\newcommand\dropcapil[3]{%
    \renewcommand{\LettrineFontHook}{\initfamily}%
    \lettrine[lines=#1,nindent=0pt]{#2}{#3}%
}
%% Define a command for non-illuminated first lines.
%% Syntax: \dropcap{lines}{initial}{caps}
%% Parameters: same as \dropcapil
\newcommand\dropcap[3]{%
    \renewcommand{\LettrineFontHook}{\normalfont}%
    \lettrine[lines=#1,nindent=0pt]{#2}{#3}%
}

%% Prevent text from going outside the margins, by making the word spacing sloppy
\sloppy

%% list the parts we want to compile
\includeonly{./tex/prolegomena,./tex/liber-primus}

\begin{document}

%% "frontmatter" command throws up weird errors
%% ! Missing \endcsname inserted.
%% <to be read again> 
%%                    \protect 
%% l.10 
%% Note: only ./tex/prolegomena included
%\frontmatter
\include{./tex/title}
\include{./tex/dedication}
\include{./tex/greek-quotes}
\include{./tex/prolegomena}

%% ToC generation gives obscure errors
%\tableofcontents

\mainmatter

\include{./tex/liber-primus}
\include{./tex/liber-secundus}
\include{./tex/liber-tertius}
\include{./tex/liber-quartus}
\include{./tex/liber-quintus}
\include{./tex/liber-sextus}
\include{./tex/liber-septimus}

\appendix
\include{./tex/nomenclator}
\include{./tex/index-rerum-et-verborum}
\include{./tex/index-graecarum-vocum}
\include{./tex/index-orientalium-vocum}
\include{./tex/errata}

\backmatter
\include{./tex/operis-finis}
\include{./tex/fragmenta-selecta}

\end{document}
