The line numbers in the PDF will have the form of annotations. To save work
a program has been developed to automatically generate the numbers in roughly
the correct position for sets of pages. As the original has over 900
pages of text, and each page requires 9 notes (sometimes less), this requires
about 8100 notes to be generated.

Doing this by hand in a PDF reading program (like Acrobat Reader or OSX Preview)
would be tedious, especially since these programs become extremely slow when
trying to handle annotations.

To avoid this, a system has been developed which uses XFDF files to automate
most of the hard work. Though a lot of tedious and careful work is required,
the line numbers only need to be added once per source-PDF.

The procedure to add the line numbers to the source PDF goes roughly as follows:

- 'xfdfnotes' is a program written in C (source in xfdfgen.c) by domoviridi
  which generates an xfdf file to stdout.
     This xfdf file describes all the annotations to be added to one or more
  chapters of the PDF original. These annotations are of the "freetext" type,
  with the simple "content" subtype.
  The program uses a configuration file. The name of this configuration file
  (usually called 'annots.cfg') is passed to the program as a parameter.
  Example invocation:
         xfdfnotes annots.cfg >notes.xfdf
  The values in the configuration file can be tweaked to make the line numbers
  appear more or less in the correct position in the PDF. 

- Adobe Acrobat is used to load the PDF original and import the xfdf file.
  Then the annotations need to be manually adjusted to match the scanned
  text.
     Most commonly the line numbers need to be moved up or down slightly.
  Sometimes tables, images or section headings make it necessary to remove
  some of the higher line numbers.
  This adjustment needs to be done page-by-page, by hand.

- The annotations can then be exported again from Adobe Acrobat as an xfdf file.

  Select "Comment" in the toolbar on the right. Select the "..." for a menu
  of more options, and select "Export All To Data File ...". In the dialogue
  window that opens select "Acrobat XFDF Files" as "Format:", set a suitable
  name at "Save As:", and the directory you want.
  These exported annotations wil be of the "freetext" type, but with the
  "contents-richtext" subtype.
    Note: do not simply save the PDF from Adobe Acrobat, as this will give a
  very bloated version of the file (800 MB rather than 78 MB.}

- 'annotform.xslt' is a script that will transform the xfdf output
  of Adobe Acrobat into a much simpler and compact form, using the
  "freetext/content" type again.
     Command:
  xsltproc tools/annotform.xslt 1629-export.xfdf >nuts.xfdf


- Adobe Acrobat can then be used to load the source PDF and import the
  simplified xfdf, and, without making any changes, save the PDF. If all went
  well, you now have a PDF with the new line numbers added, which is still less
  than 100 MB in size.
